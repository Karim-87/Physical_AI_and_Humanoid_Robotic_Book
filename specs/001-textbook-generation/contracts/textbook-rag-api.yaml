# API Contract for Textbook RAG Service

## Base URL
`/api/v1`

## Authentication
- Public endpoints: No authentication required
- Personalized endpoints: Bearer token authentication required

## Rate Limiting
- All endpoints: 60 requests per hour per IP address
- Exceeding limit returns 429 Too Many Requests

## Endpoints

### Textbook Content

#### GET /textbook/chapters
Get list of all textbook chapters

**Response (200 OK):**
```json
{
  "chapters": [
    {
      "id": "string",
      "title": "string",
      "order": "integer",
      "language": "string",
      "metadata": "object"
    }
  ]
}
```

#### GET /textbook/chapters/{chapter_id}
Get specific chapter content

**Response (200 OK):**
```json
{
  "id": "string",
  "title": "string",
  "content": "string",
  "order": "integer",
  "language": "string",
  "metadata": "object"
}
```

### RAG Chatbot

#### POST /rag/query
Submit a query to the RAG system

**Request Body:**
```json
{
  "query": "string (1-1000 chars)",
  "language": "string (optional, default: 'en')",
  "context": "string (optional, selected text)"
}
```

**Response (200 OK):**
```json
{
  "response": "string",
  "sources": [
    {
      "chapter_id": "string",
      "chapter_title": "string",
      "section": "string"
    }
  ],
  "confidence": "number"
}
```

**Response (429 Too Many Requests):**
```json
{
  "error": "Rate limit exceeded",
  "message": "Maximum 60 requests per hour per IP"
}
```

#### POST /rag/query-by-selection
Submit a query based on selected text

**Request Body:**
```json
{
  "selected_text": "string (1-500 chars)",
  "question": "string (optional, user's question about the text)"
}
```

**Response (200 OK):**
```json
{
  "response": "string",
  "sources": [
    {
      "chapter_id": "string",
      "chapter_title": "string",
      "section": "string"
    }
  ],
  "confidence": "number"
}
```

### Authentication

#### POST /auth/register
Register a new user

**Request Body:**
```json
{
  "username": "string (3-50 chars)",
  "email": "string (optional)",
  "password": "string (8+ chars)"
}
```

**Response (201 Created):**
```json
{
  "user_id": "string",
  "username": "string",
  "message": "Registration successful"
}
```

#### POST /auth/login
Login user

**Request Body:**
```json
{
  "username": "string",
  "password": "string"
}
```

**Response (200 OK):**
```json
{
  "token": "string",
  "user_id": "string",
  "username": "string"
}
```

#### POST /auth/logout
Logout user

**Headers:**
```
Authorization: Bearer {token}
```

**Response (200 OK):**
```json
{
  "message": "Successfully logged out"
}
```

### User Preferences (Requires Authentication)

#### GET /user/preferences
Get user preferences

**Headers:**
```
Authorization: Bearer {token}
```

**Response (200 OK):**
```json
{
  "preferences": "object",
  "language": "string",
  "personalization_enabled": "boolean"
}
```

#### PUT /user/preferences
Update user preferences

**Headers:**
```
Authorization: Bearer {token}
```

**Request Body:**
```json
{
  "preferences": "object",
  "language": "string",
  "personalization_enabled": "boolean"
}
```

**Response (200 OK):**
```json
{
  "message": "Preferences updated successfully"
}
```

#### GET /user/recommendations
Get personalized chapter recommendations

**Headers:**
```
Authorization: Bearer {token}
```

**Response (200 OK):**
```json
{
  "recommendations": [
    {
      "chapter_id": "string",
      "chapter_title": "string",
      "reason": "string"
    }
  ]
}
```